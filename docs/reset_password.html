<!DOCTYPE html>
<html>
  <body>
    <script>
      // Supporta sia hash (#access_token=...) che query (?token=...)
      let token = null;

      // 1) Formato nuovo: ?token=...
      const query = new URLSearchParams(window.location.search);
      if (query.get("token")) {
        token = query.get("token");
      }

      // 2) Formato vecchio: #access_token=...
      if (!token) {
        const hash = window.location.hash.substring(1);
        const params = new URLSearchParams(hash);
        token = params.get("access_token");
      }

      if (token) {
        // Redirect allo schema custom
        window.location.href = "appbase://reset?token=" + token;

        // Fallback dopo 2 secondi
        setTimeout(() => {
          document.body.innerHTML = `
            <h2>Apri l'app per completare il reset password</h2>
            <p>Se l'app non si Ã¨ aperta automaticamente, clicca qui:</p>
            <a href="appbase://reset?token=${token}">Apri l'app</a>
          `;
        }, 2000);
      } else {
        document.body.innerHTML = "<h2>Token non trovato</h2>";
      }
    </script>
  </body>
</html>
